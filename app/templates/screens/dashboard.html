<div class="ambient-glow-tr"></div>
<div class="app-container grid-bg">
    <!-- Header -->
    <header class="app-header" style="padding-top: 56px;">
        <div>
            <span style="font-size: 12px; letter-spacing: 0.15em; color: var(--text-muted); text-transform: uppercase; font-weight: 700;">DNA Engine</span>
            <h1 class="font-tanker" style="font-size: 24px; letter-spacing: 0.05em;">DASHBOARD</h1>
        </div>
        <div style="display: flex; align-items: center; gap: 16px;">
            <button class="btn-icon btn-ghost" style="position: relative;">
                üîî
                <span style="position: absolute; top: 8px; right: 8px; width: 8px; height: 8px; background: var(--neon-red); border-radius: 50%; box-shadow: 0 0 8px var(--neon-red);"></span>
            </button>
            <div id="user-avatar" style="width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--text-muted); background: var(--bg-card); display: flex; align-items: center; justify-content: center;">
                üë§
            </div>
        </div>
    </header>

    <main class="main-content" style="padding: 0 24px 100px;">
        <!-- Loading State -->
        <div id="loading" style="text-align: center; padding: 40px;">
            <div style="width: 40px; height: 40px; border: 3px solid var(--glass-border); border-top-color: var(--neon-red); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
            <p style="color: var(--text-muted); margin-top: 16px; font-size: 14px;">Loading your data...</p>
        </div>

        <!-- Content (hidden until loaded) -->
        <div id="dashboard-content" style="display: none;">
            <!-- Balance Overview -->
            <section class="mt-4">
                <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 4px;">
                    <span style="color: var(--text-secondary); font-size: 14px; font-weight: 500;">Total Balance</span>
                    <span id="user-tier" style="padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 700; background: rgba(255, 23, 68, 0.1); color: var(--neon-red); border: 1px solid rgba(255, 23, 68, 0.2); text-transform: uppercase; letter-spacing: 0.05em;">Pro Tier</span>
                </div>
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <h2 class="font-tanker" style="font-size: 42px; line-height: 1;">
                        $<span id="user-balance">0</span>
                    </h2>
                    <div style="text-align: right;">
                        <span style="color: #00ff9d; font-size: 14px; font-weight: 700; display: flex; align-items: center; gap: 4px;">
                            üìà +12.4%
                        </span>
                        <span style="font-size: 12px; color: var(--text-muted);">this week</span>
                    </div>
                </div>
            </section>

            <!-- Primary CTA -->
            <a href="/new?screen=browse" class="btn neon-btn w-full mt-4" style="height: 56px; border-radius: 12px; font-family: 'Tanker', sans-serif; font-size: 20px; letter-spacing: 0.05em; text-decoration: none; display: flex; align-items: center; justify-content: center;">
                ‚ûï START NEW BET PROTOCOL
            </a>

            <!-- Quick Stats -->
            <div class="stat-grid mt-4">
                <div class="stat-card">
                    <div style="position: absolute; bottom: -16px; right: -16px; font-size: 80px; opacity: 0.1; transform: rotate(12deg);">üèÜ</div>
                    <span class="stat-label">Win Rate</span>
                    <div>
                        <span id="win-rate" class="stat-value">0</span>
                        <span class="stat-suffix">%</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div style="position: absolute; bottom: -16px; right: -16px; font-size: 80px; opacity: 0.1; transform: rotate(12deg);">üìä</div>
                    <span class="stat-label">Total Parlays</span>
                    <div>
                        <span id="total-bets" class="stat-value">0</span>
                        <span style="font-size: 12px; color: var(--text-muted); margin-left: 4px;">Lifetime</span>
                    </div>
                </div>
            </div>

            <!-- Active Bets -->
            <section class="mt-4">
                <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px;">
                    <h3 class="font-tanker" style="font-size: 20px; letter-spacing: 0.05em; display: flex; align-items: center; gap: 8px;">
                        <span style="width: 8px; height: 8px; border-radius: 50%; background: var(--neon-red); animation: pulse 1.5s infinite; box-shadow: 0 0 10px var(--neon-red);"></span>
                        ACTIVE PROTOCOLS
                    </h3>
                    <a href="#" style="font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.1em; font-weight: 700; text-decoration: none;">View All</a>
                </div>

                <div id="active-bets-list">
                    <!-- Bets will be populated here -->
                </div>
            </section>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="/new?screen=dashboard" class="nav-item active">
            <div style="position: relative;">
                <span style="font-size: 24px;">üè†</span>
                <div style="position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); width: 4px; height: 4px; background: var(--neon-red); border-radius: 50%;"></div>
            </div>
            <span class="nav-label">Home</span>
        </a>
        <a href="/new?screen=browse" class="nav-item">
            <span style="font-size: 24px;">üîç</span>
            <span class="nav-label">Browse</span>
        </a>
        <a href="#" class="nav-item">
            <span style="font-size: 24px;">üìä</span>
            <span class="nav-label">Activity</span>
        </a>
        <a href="#" class="nav-item">
            <span style="font-size: 24px;">üë§</span>
            <span class="nav-label">Profile</span>
        </a>
    </nav>
</div>

<script>
// Fetch dashboard data from mock API
async function loadDashboard() {
    try {
        // Fetch user data and bets in parallel
        const [userRes, betsRes] = await Promise.all([
            fetch('/api/mock/user/me'),
            fetch('/api/mock/user/bets')
        ]);
        
        if (!userRes.ok || !betsRes.ok) {
            throw new Error('Failed to load data');
        }
        
        const user = await userRes.json();
        const betsData = await betsRes.json();
        
        // Update UI
        document.getElementById('user-balance').textContent = user.balance.toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
        
        document.getElementById('user-tier').textContent = user.tier.toUpperCase() + ' TIER';
        
        document.getElementById('win-rate').textContent = (user.win_rate * 100).toFixed(1);
        
        document.getElementById('total-bets').textContent = user.total_bets;
        
        // Render active bets
        renderActiveBets(betsData.bets || []);
        
        // Show content, hide loading
        document.getElementById('loading').style.display = 'none';
        document.getElementById('dashboard-content').style.display = 'block';
        
    } catch (err) {
        console.error('Dashboard load error:', err);
        document.getElementById('loading').innerHTML = `
            <p style="color: var(--neon-red);">Failed to load data</p>
            <button onclick="loadDashboard()" class="btn btn-primary mt-3">Retry</button>
        `;
    }
}

function renderActiveBets(bets) {
    const container = document.getElementById('active-bets-list');
    
    if (bets.length === 0) {
        container.innerHTML = `
            <div style="text-align: center; padding: 40px; color: var(--text-muted);">
                <p>No active bets</p>
                <a href="/new?screen=browse" class="btn btn-secondary mt-3">Place a bet</a>
            </div>
        `;
        return;
    }
    
    container.innerHTML = bets.map(bet => {
        const isWinning = bet.status === 'winning';
        const statusBadge = isWinning 
            ? '<span style="padding: 2px 6px; background: rgba(0, 255, 157, 0.1); color: #00ff9d; border: 1px solid rgba(0, 255, 157, 0.3); border-radius: 4px; font-size: 10px; font-weight: 700; text-transform: uppercase;">Winning</span>'
            : '<span style="padding: 2px 6px; background: rgba(255, 255, 255, 0.05); color: var(--text-muted); border: 1px solid var(--glass-border); border-radius: 4px; font-size: 10px; font-weight: 700; text-transform: uppercase;">Pending</span>';
        
        const firstLeg = bet.legs[0];
        const legText = firstLeg ? `${firstLeg.market} ${firstLeg.line > 0 ? '+' : ''}${firstLeg.line}` : 'Parlay';
        
        return `
            <div class="card-neon mb-3" style="padding: 20px; position: relative;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--bg-card); display: flex; align-items: center; justify-content: center; border: 1px solid var(--text-muted);">
                            üèÄ
                        </div>
                        <div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <h4 style="font-size: 14px; font-weight: 700;">Game ${bet.game_id}</h4>
                                ${statusBadge}
                            </div>
                            <p style="font-size: 12px; color: var(--text-muted); margin-top: 2px;">${legText}</p>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <span class="font-tanker" style="font-size: 20px; color: ${isWinning ? 'var(--neon-red)' : 'var(--text-primary)'};">${bet.odds > 0 ? '+' : ''}${bet.odds || '+240'}</span>
                    </div>
                </div>
                
                <div style="height: 1px; background: linear-gradient(90deg, transparent, var(--glass-border), transparent); margin: 12px 0;"></div>
                
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <p style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 4px;">Wager</p>
                        <p class="font-tanker" style="font-size: 18px;">$${bet.wager.toFixed(2)}</p>
                    </div>
                    <div style="text-align: right;">
                        <p style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 4px;">Est. Payout</p>
                        <p class="font-tanker" style="font-size: 18px; color: #00ff9d;">$${bet.potential_payout.toFixed(2)}</p>
                    </div>
                </div>

                ${isWinning ? `
                <div class="mt-3" style="padding-top: 8px;">
                    <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px;">
                        <span style="color: var(--text-secondary);">${legText}</span>
                        <span style="color: var(--neon-red);">Winning</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 85%;"></div>
                    </div>
                </div>
                ` : ''}
            </div>
        `;
    }).join('');
}

// Load on page load
document.addEventListener('DOMContentLoaded', loadDashboard);

// Refresh every 30 seconds
setInterval(loadDashboard, 30000);
</script>

<style>
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}
</style>
